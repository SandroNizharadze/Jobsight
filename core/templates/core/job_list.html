{% extends "core/base.html" %}
{% load i18n %}
{% load static %}

{% block title %}{% trans "ვაკანსიები" %} | Jobsy{% endblock %}

{% block hero_section %}
    <!-- Desktop Hero Section -->
    <div class="hidden md:block">
        {% include 'core/components/job_list/hero_section.html' %}
    </div>
    
    <!-- Mobile Hero Section -->
    {% include 'core/components/mobile/job_list/mobile_hero.html' %}
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    {% include 'core/components/job_list/filters_section.html' %}
    
    <!-- Mobile Job Cards (visible only on mobile) -->
    {% include 'core/components/mobile/job_list/mobile_job_cards.html' %}
    
    <!-- Desktop Job Cards (visible only on desktop) -->
    <div class="hidden md:block">
        {% include 'core/components/job_list/job_cards.html' %}
    </div>
</div>
{% endblock %}

{% block bottom_section %}
    {% include 'core/components/job_list/employer_cta.html' %}
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Salary slider functionality
    const salarySlider = document.getElementById('salary-slider');
    const salaryValue = document.getElementById('salary-value');
    
    if (salarySlider && salaryValue) {
        // Update value display on slider change
        salarySlider.addEventListener('input', function() {
            salaryValue.textContent = '₾ ' + this.value;
        });
        
        // Improve touch experience - don't submit immediately while dragging on mobile
        let touchTimeout;
        salarySlider.addEventListener('touchend', function() {
            clearTimeout(touchTimeout);
            touchTimeout = setTimeout(function() {
                document.getElementById('filter-form').submit();
            }, 500); // Small delay to prevent multiple submissions
        });
    }
    
    // Auto-submit filters
    const autoSubmitFilters = document.querySelectorAll('.filter-auto-submit');
    autoSubmitFilters.forEach(function(filter) {
        if (filter.type === 'range') {
            // For range sliders, don't auto-submit on desktop
            filter.addEventListener('change', function() {
                // Only submit if not a touch device (to avoid double submission)
                if (!('ontouchstart' in window)) {
                    document.getElementById('filter-form').submit();
                }
            });
        } else {
            // For other inputs (select, checkbox), auto-submit on change
            filter.addEventListener('change', function() {
                document.getElementById('filter-form').submit();
            });
        }
    });
    
    // Reset filters button
    const resetButton = document.getElementById('reset-filters');
    if (resetButton) {
        resetButton.addEventListener('click', function() {
            window.location.href = '{% url 'job_list' %}?show_filters=1';
        });
    }
    
    // Filter remove links
    const filterRemoveLinks = document.querySelectorAll('.filter-remove-link');
    filterRemoveLinks.forEach(function(link) {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            window.location.href = this.getAttribute('href');
        });
    });
    
    // Smooth scroll to filters when they're shown
    if (window.location.hash === '#filters') {
        const filtersElement = document.getElementById('filters');
        if (filtersElement) {
            setTimeout(function() {
                filtersElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 100);
        }
    }
    
    // Make filter button sticky on mobile scroll
    const filterButton = document.querySelector('a[href*="show_filters=1"]');
    if (filterButton && window.innerWidth < 768) {
        let lastScrollTop = 0;
        window.addEventListener('scroll', function() {
            const st = window.pageYOffset || document.documentElement.scrollTop;
            if (st > lastScrollTop && st > 200) {
                // Scrolling down & past header
                filterButton.classList.add('fixed', 'bottom-4', 'right-4', 'z-50', 'shadow-lg');
            } else if (st < 100) {
                // Scrolling up & near top
                filterButton.classList.remove('fixed', 'bottom-4', 'right-4', 'z-50', 'shadow-lg');
            }
            lastScrollTop = st <= 0 ? 0 : st;
        });
    }
});
</script>
{% endblock %} 