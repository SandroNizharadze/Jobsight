{% load i18n %}

<!-- Rejection Reasons Modal -->
<div id="rejectionReasonsModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden overflow-y-auto h-full w-full" aria-hidden="true">
  <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-xl bg-white">
    <div class="mt-3">
      <h3 class="text-lg font-medium leading-6 text-gray-900 mb-4">{% trans "Rejection Reasons" %}</h3>
      
      <div class="mb-4">
        <h4 class="text-sm font-medium text-gray-700 mb-2">{% trans "Reasons:" %}</h4>
        <ul id="rejectionReasonsList" class="list-disc pl-5 text-sm text-gray-600">
          <!-- Reasons will be populated here -->
        </ul>
      </div>
      
      <div class="mb-4">
        <h4 class="text-sm font-medium text-gray-700 mb-2">{% trans "Additional Feedback:" %}</h4>
        <p id="rejectionFeedback" class="text-sm text-gray-600 italic">
          <!-- Feedback will be populated here -->
        </p>
      </div>
      
      <div class="flex justify-end">
        <button type="button" id="closeRejectionModal" class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50">
          {% trans "Close" %}
        </button>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // View rejection reasons
  const rejectionReasonButtons = document.querySelectorAll('.view-rejection-reasons');
  const rejectionReasonsModal = document.getElementById('rejectionReasonsModal');
  const rejectionReasonsList = document.getElementById('rejectionReasonsList');
  const rejectionFeedback = document.getElementById('rejectionFeedback');
  const closeRejectionModal = document.getElementById('closeRejectionModal');
  
  if (rejectionReasonButtons.length > 0 && rejectionReasonsModal && rejectionReasonsList && closeRejectionModal) {
    rejectionReasonButtons.forEach(button => {
      button.addEventListener('click', function() {
        const applicationId = this.getAttribute('data-application-id');
        
        // Fetch rejection reasons
        fetch(`/api/applications/${applicationId}/rejection-reasons/`, {
          headers: {
            'X-Requested-With': 'XMLHttpRequest'
          }
        })
        .then(response => response.json())
        .then(data => {
          // Clear previous content
          rejectionReasonsList.innerHTML = '';
          rejectionFeedback.textContent = '';
          
          // Add reasons to the list
          if (data.reasons && data.reasons.length > 0) {
            data.reasons.forEach(reason => {
              const li = document.createElement('li');
              li.className = 'mb-1';
              li.textContent = reason;
              rejectionReasonsList.appendChild(li);
            });
          } else {
            const li = document.createElement('li');
            li.textContent = 'No specific reasons provided.';
            rejectionReasonsList.appendChild(li);
          }
          
          // Add feedback if available
          if (data.feedback) {
            rejectionFeedback.textContent = data.feedback;
          } else {
            rejectionFeedback.textContent = 'No additional feedback provided.';
          }
          
          // Show the modal
          rejectionReasonsModal.classList.remove('hidden');
        })
        .catch(error => {
          console.error('Error fetching rejection reasons:', error);
        });
      });
    });
    
    // Close modal when clicking the close button
    closeRejectionModal.addEventListener('click', function() {
      rejectionReasonsModal.classList.add('hidden');
    });
    
    // Close modal when clicking outside
    rejectionReasonsModal.addEventListener('click', function(e) {
      if (e.target === rejectionReasonsModal) {
        rejectionReasonsModal.classList.add('hidden');
      }
    });
  }
});
</script> 