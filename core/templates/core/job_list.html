{% extends "core/base.html" %}
{% load i18n %}
{% load static %}

{% block title %}{% trans "ვაკანსიები" %} | Jobsight{% endblock %}

{% block extra_head %}
<style>
@media (max-width: 768px) {
  .mobile-job-cta-fix {
    margin-top: 0 !important;
    padding-top: 0 !important;
  }
  
  .mobile-job-cards-container {
    margin-bottom: 3rem !important;
    padding-bottom: 0 !important;
  }
  
  .mobile-employer-cta {
    margin-top: 0 !important;
    margin-bottom: 0 !important;
    padding-bottom: 0 !important;
  }
  
  /* Fix for empty space after CTA */
  .min-h-screen {
    min-height: auto !important;
  }
  
  /* Adjust bottom padding to account for mobile nav */
  .mobile-employer-cta section {
    padding-bottom: 1rem !important;
    margin-bottom: 0 !important;
  }
  
  /* Fix for footer spacing */
  footer {
    margin-top: 0 !important;
  }
  
  /* Remove any extra space in the hero section */
  .md\:hidden {
    margin-bottom: 0 !important;
  }
  
  /* Force the footer to be directly below the CTA */
  .mobile-employer-cta + * {
    margin-top: 0 !important;
    padding-top: 0 !important;
  }
  
  /* Fix for the job list page specifically */
  .job-list-page-container {
    min-height: auto !important;
    margin-bottom: 0 !important;
    padding-bottom: 0 !important;
  }
}
</style>
{% endblock %}

{% block hero_section %}
    <!-- Desktop Hero Section -->
    <div class="hidden md:block">
        {% include 'core/components/job_list/hero_section.html' %}
    </div>
    
    <!-- Mobile Hero Section, Filters, and Job Cards -->
    <div class="md:hidden job-list-page-container">
        {% include 'core/components/mobile/job_list/mobile_hero.html' %}
        
        <!-- Mobile Filters (only visible when active) -->
        <div class="container mx-auto px-0 mb-4">
            {% include 'core/components/mobile/job_list/mobile_filters.html' %}
        </div>
        
        <!-- Mobile Job Cards -->
        <div class="mobile-job-cards-container">
            {% include 'core/components/mobile/job_list/mobile_job_cards.html' %}
        </div>
        
        <!-- Mobile Employer CTA (only on mobile) -->
        <div class="mobile-employer-cta job-list-last-element">
            <section class="mt-0 mb-0">
                <div class="container mx-auto px-4">
                    <div class="bg-amber-300 rounded-t-2xl rounded-b-2xl p-6">
                        <div class="grid grid-cols-1 items-center">
                            <div>
                                <h2 class="text-2xl font-bold mb-3">{% trans "გჭირდებათ თანამშრომელი?" %}</h2>
                                <div class="mb-6 text-gray-800">
                                    <p>{% trans "გამოაქვეყნეთ ვაკანსია ჯობსიზე და იპოვეთ საუკეთესო კანდიდატები თქვენი კომპანიისთვის." %}</p>
                                    <p>{% trans "ათასობით პროფესიონალი ეძებს ახალ შესაძლებლობებს ყოველდღე." %}</p>
                                </div>
                                <a href="{% url 'pricing' %}" 
                                   class="inline-block bg-gray-900 hover:bg-gray-800 text-white font-medium px-6 py-3 rounded-xl transition-colors">
                                    {% trans "შეიტყვეთ მეტი" %}
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 md:py-8 py-0 max-w-[1600px]" style="zoom: 90%;">
    <!-- Desktop Filters (hidden on mobile) -->
    <div class="hidden md:block">
        {% include 'core/components/job_list/filters_section.html' %}
    </div>
    
    <!-- Desktop Job Cards (visible only on desktop) -->
    <div class="hidden md:block">
        {% include 'core/components/job_list/job_cards.html' %}
    </div>
</div>
{% endblock %}

{% block bottom_section %}
    <!-- Desktop Employer CTA (hidden on mobile) -->
    <div class="hidden md:block mt-12">
        {% include 'core/components/job_list/employer_cta.html' %}
    </div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Fix for empty space after CTA on mobile
    if (window.innerWidth < 768) {
        document.querySelector('.min-h-screen').style.minHeight = 'auto';
        
        // Add padding to the last element to account for mobile nav
        const lastElement = document.querySelector('.job-list-last-element');
        if (lastElement) {
            lastElement.style.marginBottom = '0';
            lastElement.style.paddingBottom = '0';
        }
    }

    // Salary slider functionality for desktop
    const salarySlider = document.getElementById('salary-slider');
    const salaryValue = document.getElementById('salary-value');
    
    if (salarySlider && salaryValue) {
        // Update value display on slider change
        salarySlider.addEventListener('input', function() {
            salaryValue.textContent = '₾ ' + this.value;
        });
        
        // Improve touch experience - don't submit immediately while dragging on mobile
        let touchTimeout;
        salarySlider.addEventListener('touchend', function() {
            clearTimeout(touchTimeout);
            touchTimeout = setTimeout(function() {
                document.getElementById('filter-form').submit();
            }, 500); // Small delay to prevent multiple submissions
        });
    }
    
    // Auto-submit filters
    const autoSubmitFilters = document.querySelectorAll('.filter-auto-submit');
    autoSubmitFilters.forEach(function(filter) {
        if (filter.type === 'range') {
            // For range sliders, don't auto-submit on desktop
            filter.addEventListener('change', function() {
                // Only submit if not a touch device (to avoid double submission)
                if (!('ontouchstart' in window)) {
                    // Check which form to submit
                    const formId = window.innerWidth < 768 ? 'mobile-filter-form' : 'filter-form';
                    document.getElementById(formId).submit();
                }
            });
        } else {
            // For other inputs (select, checkbox), auto-submit on change
            filter.addEventListener('change', function() {
                // Check which form to submit
                const formId = window.innerWidth < 768 ? 'mobile-filter-form' : 'filter-form';
                document.getElementById(formId).submit();
            });
        }
    });
    
    // Reset filters button
    const resetButton = document.getElementById('reset-filters');
    if (resetButton) {
        resetButton.addEventListener('click', function() {
            window.location.href = '{% url 'job_list' %}?show_filters=1';
        });
    }
    
    // Filter remove links
    const filterRemoveLinks = document.querySelectorAll('.filter-remove-link');
    filterRemoveLinks.forEach(function(link) {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            window.location.href = this.getAttribute('href');
        });
    });
    
    // Smooth scroll to filters when they're shown
    if (window.location.hash === '#filters') {
        const filtersElement = document.getElementById('filters');
        if (filtersElement) {
            setTimeout(function() {
                filtersElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 100);
        }
    }
    
    // Make filter button sticky on mobile scroll
    const filterButton = document.querySelector('a[href*="show_filters=1"]');
    if (filterButton && window.innerWidth < 768) {
        let lastScrollTop = 0;
        window.addEventListener('scroll', function() {
            const st = window.pageYOffset || document.documentElement.scrollTop;
            if (st > lastScrollTop && st > 200) {
                // Scrolling down & past header
                filterButton.classList.add('fixed', 'bottom-4', 'right-4', 'z-50', 'shadow-lg');
            } else if (st < 100) {
                // Scrolling up & near top
                filterButton.classList.remove('fixed', 'bottom-4', 'right-4', 'z-50', 'shadow-lg');
            }
            lastScrollTop = st <= 0 ? 0 : st;
        });
    }
});
</script>
{% endblock %} 